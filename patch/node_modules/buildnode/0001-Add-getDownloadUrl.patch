From a1b43bca811b2fda90a63dad481442e19e33f68a Mon Sep 17 00:00:00 2001
From: Michael Vines <mvines@gmail.com>
Date: Sat, 9 Jun 2018 23:10:51 -0700
Subject: [PATCH] Add getDownloadUrl

---
 lib/artifact.js | 14 ++++++++++++--
 lib/utils.js    |  3 ++-
 2 files changed, 14 insertions(+), 3 deletions(-)

diff --git a/lib/artifact.js b/lib/artifact.js
index 8aa66c2..58d5975 100644
--- a/lib/artifact.js
+++ b/lib/artifact.js
@@ -31,7 +31,7 @@ exports.default = function (options, utils, modules) {
 
         utils.mapFields.call(this, data, fieldMap);
 
-        this.baseURL = 'organizations/' + this.organization.slug + '/pipelines/' + this.pipeline.slug + '/builds/' + this.build.number + '/artifacts/' + this.id;
+        this.baseURL = 'organizations/' + this.organization.slug + '/pipelines/' + this.pipeline.slug + '/builds/' + this.build.number + '/jobs/' + this.job.id + '/artifacts/' + this.id;
       }
 
       _createClass(Artifact, [{
@@ -45,6 +45,16 @@ exports.default = function (options, utils, modules) {
             return callback(null, stream);
           });
         }
+      }, {
+        key: 'getDownloadUrl',
+        value: function getDownloadUrl(callback) {
+          utils.req('GET', this.baseURL + '/download', null, function (err, result) {
+            if (err) {
+              return callback(err);
+            }
+            return callback(null, result.url);
+          });
+        }
       }, {
         key: 'data',
         get: function get() {
diff --git a/lib/utils.js b/lib/utils.js
index d4a1425..cd40592 100644
--- a/lib/utils.js
+++ b/lib/utils.js
@@ -29,6 +29,7 @@ exports.default = function (options) {
 
     var req = {
       url: url,
+      followRedirect: false,
       auth: auth,
       body: body,
       method: method,
-- 
2.15.1 (Apple Git-101)

